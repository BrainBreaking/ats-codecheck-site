<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Secure Download - ATS CodeCheck</title>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
</head>
<body>
<h2>üîê Secure Download</h2>
<button id="loginBtn">Login with Google</button>

<script>
    // Initialize Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDfKWha2EwdtpgUPnjxjM9SCJ1J5nNEmUM",
        authDomain: "ats-nonprod.firebaseapp.com",
        projectId: "ats-nonprod",
        appId: "ats-nonprod"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    document.getElementById("loginBtn").addEventListener("click", async () => {
        const provider = new firebase.auth.GoogleAuthProvider();
        try {
            const result = await auth.signInWithPopup(provider);
            const token = await result.user.getIdToken();

            // Redirect with token to Cloud Run secured endpoint
            const version = "v1.0.0";
            const platform = "macos";
            const url = `https://securedownload-<region-id>.a.run.app/?version=${version}&platform=${platform}&token=${token}`;
            window.location.href = url;
        } catch (error) {
            console.error("Authentication failed:", error);
        }
    });
</script>
</body>
</html>